---
kind: pipeline
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: integration-test
    image: sighup/kind:v1.12.3
    environment:
      CLUSTER_HOST: docker
    commands:
      - /test prometheus-operator kube-state-metrics node-exporter alertmanager-operated grafana kubeadm-sm prometheus-operated
    volumes:
      - name: dockersock
        path: /var/run
    when:
      event:
      - push

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}
